#!/bin/zsh

FORCE=""
while getopts "f" opt; do
    case $opt in
        f)
            FORCE=1
            ;;
    esac
done
shift $OPTIND-1

TIMEFILE="$(mktemp)"
trap "rm $TIMEFILE" QUIT INT EXIT

REALBIN="$GOPATH/bin/$(basename $1)"

if [[ -z "$GOPATH" ]]; then
    echo "No GOPATH. Install Go."
fi

if [[ "$(uname)" == "Darwin" ]]; then
  DATE=$(date -j -v "-1w" "+%Y%m%d%H%M")
  touch -t "$DATE" "$TIMEFILE"
else
  DATE=$(date -d '7 days ago')
  touch -d "$DATE" "$TIMEFILE"
fi

if [[ -n "$FORCE" || ! -f "$REALBIN" || "$REALBIN" -ot "$TIMEFILE" ]]; then
  go install "github.com/zostay/dotfiles-go/cmd/$(basename $1)@latest"
fi
